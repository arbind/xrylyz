%rylyz{:name=>"quiz"}
  :javascript
    var intervalTimer;
    var stopProgress;

    function noMoreAnswering() {
      $('.choice').removeAttr('onclick')
      //also hide hint and pass
    }
    function noMoreHinting() {
      $('.hint').removeAttr('onclick')
      //also hide hint and pass
    }
    function stopProgress() {
      clearInterval(intervalTimer)
      noMoreAnswering();
    }
    function startProgress() {
      var progress = 0;
      var interval = 15;
      var f = function() {
        progress += 1;
        $('.progress').css('width', ''+ (100-progress) + '%')
        if (99 < progress) stopProgress();
      }
      intervalTimer = setInterval(f, interval*1000/100);
    }

    function disableChoosing() {
      noMoreAnswering();
      stopProgress();
    }
    function choose(num, question_id) {
      var answer = '.answer' + num
      $(answer).addClass('selected');
      disableChoosing();
      // send choice to server
      var hiEvent= {queue:'hi', appName:'quiz', screenName:'question', type:'choose-answer', choice:num, id: question_id}
      Rylyz.event.fireEvent(hiEvent);
    }

    function hint(question_id) {
      // GIVE HINT
      noMoreHinting();
      // send choice to server
      var hiEvent= {queue:'hi', appName:'quiz', screenName:'question', type:'hint', id: question_id}
      Rylyz.event.fireEvent(hiEvent);
    }
    function pass(question_id) {
      disableChoosing();
      // send choice to server
      var hiEvent= {queue:'hi', appName:'quiz', screenName:'question', type:'pass', id: question_id}
      Rylyz.event.fireEvent(hiEvent);
    }


  %app{:name=>"quiz", "data-defaults"=>"{title:'Quiz'}", :"start-screen" => "game"}
    %screen{:name=>"input-nickname"}
    %screen{:name=>"game"}
    %screen{:name=>"question"}
    %screen{:name=>"leaderboard"}
    %screen{:name=>"submit-question"}


  %screen{:name=>"input-nickname"}
    #signin
      %h1 Play Quiz
      %form{:id=>"nickname-form", :class=>"nickname", :target=>"", :action => "", :method => "", :name=>"nickname"}
        %h3 Please enter your nickname:
        .field
          %input.text{:type => "text", :name => "nickname", :placeholder => "i.e. tenderlovemaking"}
        .field
          %a.button.play{:onclick=>"Rylyz.sendForm(this)"} Start Playing

  %screen{:name=>"game"}
    .game-board
      .level-1
        %collection{:name=>"level1-questions"}
      .level-2
        %collection{:name=>"level2-questions"}
      .level-3
        %collection{:name=>"level3-questions"}
    .button-bar
      .button{"nav-onClick"=>"input-nickname"} Enter Name
      .button{"nav-onClick"=>"question"} Question
      .button{"nav-onClick"=>"leaderboard"} Leaderboard
      .button{"nav-onClick"=>"submit-question"} Submit Question4

  %collection{:name=>"level1-questions", :item=>"question-item", "data-defaultss"=>"[{level:1},{level:2},{level:3},{level:4},{level:5}]"}
    %h2 level1
    .level
      %collection

  %collection{:name=>"level2-questions", :item=>"question-item", "data-defaultss"=>"[{level:1},{level:2},{level:3},{level:4},{level:5}]"}
    %h2 level2
    .level
      %collection

  %collection{:name=>"level3-questions", :item=>"question-item", "data-defaultss"=>"[{level:1},{level:2},{level:3},{level:4},{level:5}]"}
    %h2 level3
    .level
      %collection

  %item{:name=>"question-item"}
    ! [! if (answered) { !]
    .question-card.answered
      %br [[category]] - [[answered]]
    ! [! } else { !]
    .question-card.unanswered{"fire-onClick"=>"{queue:'hi', type:'select-question', select:'[[id]]'}"}
      %br [[category]] - [[answered]]
    ! [! } !]

  %screen{:name=>"question"}
    .about
      About
    #progress-bar
      .progress
    .score{onClick: "startProgress();"}
      99
    %object{:name=>"prompt"}
    .button-bar.close
      .button{"nav-onClick"=>"game"} Close

  %object{:name=>"prompt", "data-defaults"=>"{id: '', prompt:'', answer1:'', answer2:'', answer3:'', answer4:''}"}
    #trivia
      %h1
        [[prompt]]
      .inner
        #trivia-picks
          %h2{:style => "color: black;"} Choose your answer:
          #choices
            .choice.answer1{:onclick => "choose(1, '[[id]]')"}
              [[answer1]]
            .choice.answer2{:onclick => "choose(2, '[[id]]')"}
              [[answer2]]
            .choice.answer3{:onclick => "choose(3, '[[id]]')"}
              [[answer3]]
            .choice.answer4{:onclick => "choose(4, '[[id]]')"}
              [[answer4]]
        #trivia-results
          %object{:name=>"status"}
          %collection{:name=>"leaders"}
    .button-bar.question-menu
      .button.hint{onClick: "hint('[[id]]');"}
        Hint
      .button.pass{onClick: "pass('[[id]]');"}
        Pass

  %object{:name=>"status", "data-defaults" => "{status:'...', klass:'hidden'}"}
    %div{:class => '[[klass]]'}
      %h2#status
        [[status]]

  %collection{:name=>"leaders", :item=>"leader", "data-defaults"=>"[{nickname:'mike', score:10},{nickname:'john', score:20}]"}
    %h2 Leaders
    %collection

  %item{:name=>"leader"}
    .leader
      [[nickname]] - [[score]]


  %screen{:name=>"leaderboard"}
    %collection{:name=>"leaders"}
    .button-bar
      .button{"nav-onClick"=>"game"} Back


  %screen{:name=>"submit-question"}
    .button-bar
      .button{"nav-onClick"=>"game"} Back

